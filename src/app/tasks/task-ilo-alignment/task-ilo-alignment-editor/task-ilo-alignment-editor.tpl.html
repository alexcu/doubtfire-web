<div class="task-ilo-alignment-editor row ">
  <div class="alignment-panels" ng-class="{'col-md-9': showCsv}">
    <div class="{{hidePanel ? '' : 'panel panel-primary'}}">
      <div ng-hide="hidePanel" class="panel-heading clearfix">
        <h3 class="panel-title">
          {{showIncludeTasks ? 'Select Tasks' : 'Intended Learning Outcome Alignment'}}
        </h3>
        <div class="col-sm-8 pull-left" style="padding-left: 0;">
          <div ng-show="showIncludeTasks" >
            Select tasks to include and showcase in your portfolio that demonstrates your
            understanding of each Learning Outcome.
          </div>
          <div ng-hide="showIncludeTasks">
            Align tasks to an Intended Learning Outcome by selecting the red circle and choosing a rating,
            providing an optional rational to justify why that task is related to the outcome selected.
          </div>
        </div>
        <div class="btn-group pull-right">
          <button class="btn btn-default" ng-model="showGraph" btn-radio="true" uncheckable>
            <i class="fa fa-bar-chart"></i>
          </button>
        </div>
      </div><!--/heading-->
      <div class="panel-body" ng-show="tasks.length == 0 || unit.ilos.length == 0 || showIncludeTasks">
        <div class="large-notice-block" ng-hide="tasks.length > 0">
          <i class="fa fa-2x fa-tasks"></i>
          <p>No tasks in this unit</p>
        </div>
        <div class="large-notice-block" ng-hide="unit.ilos.length > 0 || showIncludeTasks">
          {{unit.ilos.length > 0 && ! showIncludeTasks}}
          <i class="fa fa-2x fa-graduation-cap"></i>
          <p>No learning outcomes in this unit</p>
        </div>
      </div>
      <!--/select-panel-body-->
      <table
        class="table table-hover table-bordered table-condensed table-task-alignment"
        ng-hide="tasks.length == 0 || (unit.ilos.length == 0 && ! showIncludeTasks)">
        <thead>
          <tr>
            <th>Task</th>
            <th ng-show="source == project">Status</th>
            <th
              class="text-center"
              ng-repeat="ilo in unit.ilos | orderBy: 'abbreviation'"
              tooltip="{{ilo.name}}"
              tooltip-append-to-body="true"
              ng-bind="ilo.abbreviation">
            </th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr ng-repeat="task in tasks | taskForPortfolio: source === project | orderBy: 'definition.seq'">
            <th ng-bind="task.definition.name"></th>
            <td ng-if="source === project">
              <status-icon status="task.status"></status-icon>
            </td>
            <td ng-repeat="ilo in unit.ilos | orderBy: 'abbreviation'" class="ilo-alignment">
              <button ng-click="showAlignmentModal(task, ilo)" class="btn btn-sm btn-default btn-alignment">
                <task-ilo-alignment-rater
                  ng-if="alignments[task.definition.id][ilo.id]"
                  ng-model="alignments[task.definition.id][ilo.id]"
                  compact="true">
                </task-ilo-alignment-rater>
                <i
                  ng-hide="alignments[task.definition.id][ilo.id]"
                  class="fa fa-circle-o fa-3x text-danger"
                  tooltip-append-to-body="true"
                  tooltip="You decided {{task.definition.abbreviation}} is not aligned to {{ilo.abbreviation}}">
                </i>
              </button>
            </td>
            <td>
              <button
                class="btn btn-sm btn-default"
                ng-click="showBatchAlignmentModal(task)">
                <i class="fa fa-pencil"></i> Edit All
              </button>
              <button
                ng-if="showIncludeTasks"
                tooltip-enable="disableInclude(task)"
                tooltip="You cannot select this task as it is not aligned to any ILOs" tooltip-placement="left"
                tooltip-append-to-body="true"
                class="btn btn-sm btn-{{task.include_in_portfolio ? 'success' : 'default'}} text-center"
                ng-class="{
                  'task.include_in_portfolio': 'success',
                  '!task.include_in_portfolio': 'default',
                  'disableInclude(task): 'warning'
                }"
                ng-click="includeTaskInPorfolio(task)"
                ng-disabled="disableInclude(task)"
                ng-if="!disableInclude(task)">
                <i ng-class="{
                  'task.include_in_portfolio': 'fa fa-check',
                  '!task.include_in_portfolio': 'fa fa-times',
                  'disableInclude(task): 'fa fa-question'
                }"></i>
                {{task.include_in_portfolio ? '' : 'Not'}} Included
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div><!--/select-panel-->
    <div class="panel panel-default visualisation" ng-if="showGraph">
      <div class="panel-heading clearfix">
          <h4 class="panel-title pull-left">Visualisation</h4>
          <button class="pull-right close" ng-click="closeGraph()">&times;</button>
      </div>
      <div class="panel-body">
        <alignment-bar-chart unit="unit" project="project" source="source" task-status-factor="taskStatusFactor"></alignment-bar-chart>
      </div>
      <div class="panel-footer text-center">
        Hover over this panel to highlight
      </div>
    </div><!--/visualisation-->
  </div><!--/main-panels-->
  <div class="col-md-3" ng-if="showCsv">
    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">Import Task Outcome Alignments</h3>
        Import links between tasks and outcomes from a CSV containing: unit_code, learning_outcome, task_abbr, rating.
      </div>
      <div class="panel-body">
        <file-uploader
          files="taskAlignmentCSV"
          url="taskAlignmentCSVUploadUrl()"
          is-uploading="isTaskAlignmentCSVUploading"
          on-success="onTaskAlignmentCSVSuccess"
          on-complete="onTaskAlignmentCSVComplete"></file-uploader>
      </div>
      <div class="panel-heading">
        <h3 class="panel-title">Export Task Outcome Alignments</h3>
        Download a CSV of task outcome alignment details.
      </div>
      <div class="panel-body text-center">
        <button class="btn btn-primary btn-download" ng-click="downloadTaskAlignmentCSV()">
          <i class="fa fa-download"></i> Download
        </button>
      </div>
    </div><!--/csv-import-export-->
  </div><!--/csv-panels-->
</div>
